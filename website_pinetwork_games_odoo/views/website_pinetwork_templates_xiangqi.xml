<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <template id="xiangqi" name="Xiangqi">
            <t t-call="web.layout">
            &lt;!DOCTYPE html&gt;
            <html>

                <head>
                    <meta charset="UTF-8"/>
                    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
                    <title>Checkers Game</title>
                    <title>Xiangqi (Chinese Chess)</title>
                    <style>
                        :root {
                            --board-bg: #deb887;
                            --board-lines: #5d4037;
                            --piece-shadow: rgba(0, 0, 0, 0.4);
                            --highlight: rgba(76, 175, 80, 0.6);
                            --last-move: rgba(255, 235, 59, 0.4);
                            --red-piece: #b71c1c;
                            --black-piece: #212121;
                            --piece-bg: #fdf5e6;
                            --piece-border: #8d6e63;
                        }

                        * {
                            box-sizing: border-box;
                            user-select: none;
                            -webkit-tap-highlight-color: transparent;
                        }

                        body {
                            margin: 0;
                            padding: 0;
                            background-color: #2c2c2c;
                            font-family: "KaiTi", "STKaiti", "SimKai", serif;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            height: 100vh;
                            overflow: hidden;
                            color: white;
                        }

                        /* UI Overlay */
                        #ui-container {
                            width: 100%;
                            max-width: 600px;
                            height: 60px;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 0 20px;
                            z-index: 10;
                            background: #2c2c2c;
                        }

                        .status-box {
                            background: rgba(0, 0, 0, 0.5);
                            padding: 8px 16px;
                            border-radius: 20px;
                            font-size: 1rem;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }

                        .turn-dot {
                            width: 12px;
                            height: 12px;
                            border-radius: 50%;
                            display: inline-block;
                        }

                        .controls {
                            display: flex;
                            gap: 10px;
                        }

                        .btn {
                            background: #5d4037;
                            color: #fff;
                            border: none;
                            padding: 8px 12px;
                            border-radius: 6px;
                            font-size: 0.85rem;
                            cursor: pointer;
                            font-family: sans-serif;
                            transition: background 0.2s;
                        }

                        .btn:active {
                            transform: scale(0.95);
                        }

                        /* Board Container Wrapper */
                        #game-wrapper {
                            flex: 1;
                            width: 100%;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            padding: 10px;
                            overflow: hidden;
                            perspective: 1000px; /* For potential 3D effects later */
                        }

                        /* The Board Itself */
                        #game-area {
                            position: relative;
                            aspect-ratio: 9 / 10;
                            height: 95%;
                            max-height: 800px;
                            width: auto;
                            max-width: 95vw;
                            background-color: var(--board-bg);
                            border-radius: 4px;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                            padding: 4%; 
                            transition: transform 0.6s ease-in-out;
                        }

                        /* Rotate board for Black player */
                        #game-area.rotated {
                            transform: rotate(180deg);
                        }

                        /* The SVG Grid */
                        #board-svg {
                            width: 100%;
                            height: 100%;
                            display: block;
                        }

                        /* Piece Layer */
                        #piece-layer {
                            position: absolute;
                            top: 4%;
                            left: 4%;
                            width: 92%;
                            height: 92%;
                        }

                        /* Individual Piece */
                        .piece {
                            position: absolute;
                            width: 11%;
                            height: 10%;
                            margin-left: -5.5%;
                            margin-top: -5%;
                            border-radius: 50%;
                            background: radial-gradient(circle at 30% 30%, #fff, var(--piece-bg), #d7ccc8);
                            border: 2px solid var(--piece-border);
                            box-shadow: 2px 2px 5px var(--piece-shadow), inset -2px -2px 5px rgba(0,0,0,0.1);
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            font-size: clamp(12px, 3.5vh, 28px);
                            font-weight: bold;
                            cursor: pointer;
                            z-index: 2;
                            transition: transform 0.2s, box-shadow 0.2s, left 0.2s, top 0.2s; /* Added smooth movement */
                        }

                        .piece.red { color: var(--red-piece); border-color: #d32f2f; }
                        .piece.black { color: var(--black-piece); border-color: #3e2723; }
                        
                        /* Highlighting and Transforms */
                        /* Note: Transforms are handled inline by JS now to combine Rotation + Scale */

                        /* Movement Indicators */
                        .dot {
                            position: absolute;
                            width: 14px;
                            height: 14px;
                            margin-left: -7px;
                            margin-top: -7px;
                            background-color: var(--highlight);
                            border-radius: 50%;
                            z-index: 10; /* Higher than normal pieces, lower than selected */
                            cursor: pointer;
                            animation: pulse 1.5s infinite;
                        }

                        .capture-ring {
                            position: absolute;
                            width: 11%;
                            height: 10%;
                            margin-left: -5.5%;
                            margin-top: -5%;
                            border: 3px solid var(--highlight);
                            border-radius: 50%;
                            z-index: 1;
                            pointer-events: none;
                            animation: spin 3s linear infinite;
                        }

                        .last-move-highlight {
                            position: absolute;
                            width: 11%;
                            height: 10%;
                            margin-left: -5.5%;
                            margin-top: -5%;
                            background-color: var(--last-move);
                            border-radius: 10%;
                            z-index: 0;
                            pointer-events: none;
                        }

                        @keyframes pulse {
                            0% { transform: scale(0.8); opacity: 0.6; }
                            50% { transform: scale(1.2); opacity: 1; }
                            100% { transform: scale(0.8); opacity: 0.6; }
                        }

                        /* Modal Overlay (Generic) */
                        .modal-overlay {
                            position: fixed;
                            top: 0; left: 0; width: 100%; height: 100%;
                            background: rgba(0,0,0,0.85);
                            display: none;
                            justify-content: center;
                            align-items: center;
                            z-index: 100;
                            backdrop-filter: blur(5px);
                        }

                        .modal {
                            background: #fff;
                            color: #333;
                            padding: 30px;
                            border-radius: 10px;
                            text-align: center;
                            max-width: 90%;
                            width: 400px;
                            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
                            border: 4px solid var(--board-lines);
                        }

                        .rules-modal {
                            width: 500px; /* Slightly wider for reading */
                        }

                        .rules-content {
                            text-align: left;
                            max-height: 60vh;
                            overflow-y: auto;
                            margin-bottom: 20px;
                            padding-right: 10px;
                            font-size: 0.95rem;
                            line-height: 1.5;
                            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
                            user-select: text; /* Allow text selection for better interaction */
                            -webkit-user-select: text;
                        }

                        /* Force children of rules content to allow selection, overriding the global * rule */
                        .rules-content * {
                            user-select: text;
                            -webkit-user-select: text;
                        }

                        .rules-content h3 {
                            color: var(--board-lines);
                            border-bottom: 1px solid #eee;
                            padding-bottom: 5px;
                            margin-top: 15px;
                        }

                        .rules-content strong { color: var(--red-piece); }

                        .modal h2 { margin-top: 0; color: var(--board-lines); }
                        .modal p { font-size: 1.1rem; margin: 20px 0; color: #555; }
                        
                        .modal-btn-group {
                            display: flex;
                            flex-direction: column;
                            gap: 15px;
                        }
                        
                        .modal-btn-group .btn {
                            font-size: 1.1rem;
                            padding: 12px;
                        }

                        .notification {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: rgba(0,0,0,0.8);
                            color: white;
                            padding: 15px 30px;
                            border-radius: 8px;
                            pointer-events: none;
                            opacity: 0;
                            transition: opacity 0.3s;
                            z-index: 50;
                            font-size: 2rem;
                            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
                            border: 1px solid #fff;
                            white-space: nowrap;
                        }

                        .hidden { display: none !important; }

                        /* Loader */
                        #ai-loader {
                            display: none;
                            margin-left: 10px;
                            width: 16px;
                            height: 16px;
                            border: 2px solid #fff;
                            border-top: 2px solid transparent;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                        }
                        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

                    </style>
                    
                    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
                    
                    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
                    
                    <script type="text/javascript">
                        startCommonAppsAI();
                    </script>
                    
                    <div id="blockingOverlay" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
                        <div style="display: flex; background-color: white; padding: 30px; border-radius: 10px; text-align: center; font-family: Arial, sans-serif; font-size: 24px; color: #333;">
                            <div id="blocking-message" style="display: none;">
                                <div>
                                    Go to Pi Browser
                                </div>
                                <div>
                                    <a class="anchor-click" style="color: blue;" href="#" target="_blank">Click here</a>
                                </div>
                            </div>
                            <div id="paying-message" style="display: none;">
                                <div>
                                    Donate to unlock Apps
                                </div>
                                <div>
                                    <a class="anchor-click" style="color: blue;" href="#">Click here</a>
                                </div>
                                <div t-if="mainnet in ['Mainnet ON', 'Mainnet OFF']">
                                    <br/>
                                    <a id="test_app" style="color: blue;" href="#">Or here to test this app</a>
                                </div>
                            </div>
                            <div id="loading-message" style="display: block;">
                                Loading...
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="sandbox" t-att-value="sandbox"/>
                    <input type="hidden" id="mainnet" t-att-value="mainnet"/>
                    <div id="pi_prowser_message" style="display:none;">You need to access from Pi Browser.</div>
                </head>
                <body translate="no">

                    <div id="ui-container">
                        <div class="status-box">
                            <span id="turn-indicator" class="turn-dot" style="background-color: var(--red-piece);"></span>
                            <span id="turn-text">Red Turn</span>
                            <div id="ai-loader"></div>
                        </div>
                        <div class="controls">
                            <button class="btn" onclick="game.showRules()">How to Play</button>
                            <button class="btn" onclick="game.showSetup()">Reset Game</button>
                        </div>
                    </div>

                    <div id="game-wrapper" style="max-height: 70%">
                        <div id="game-area">
                            <!-- SVG Board -->
                            <svg id="board-svg" viewBox="0 0 900 1000" preserveAspectRatio="none">
                                <!-- Grid Lines -->
                                <line x1="50" y1="50" x2="850" y2="50" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="150" x2="850" y2="150" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="250" x2="850" y2="250" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="350" x2="850" y2="350" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="450" x2="850" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="550" x2="850" y2="550" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="650" x2="850" y2="650" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="750" x2="850" y2="750" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="850" x2="850" y2="850" stroke="#5d4037" stroke-width="2" />
                                <line x1="50" y1="950" x2="850" y2="950" stroke="#5d4037" stroke-width="2" />

                                <line x1="50" y1="50" x2="50" y2="450" stroke="#5d4037" stroke-width="3" />
                                <line x1="150" y1="50" x2="150" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="250" y1="50" x2="250" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="350" y1="50" x2="350" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="450" y1="50" x2="450" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="550" y1="50" x2="550" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="650" y1="50" x2="650" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="750" y1="50" x2="750" y2="450" stroke="#5d4037" stroke-width="2" />
                                <line x1="850" y1="50" x2="850" y2="450" stroke="#5d4037" stroke-width="3" />

                                <line x1="50" y1="550" x2="50" y2="950" stroke="#5d4037" stroke-width="3" />
                                <line x1="150" y1="550" x2="150" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="250" y1="550" x2="250" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="350" y1="550" x2="350" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="450" y1="550" x2="450" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="550" y1="550" x2="550" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="650" y1="550" x2="650" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="750" y1="550" x2="750" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="850" y1="550" x2="850" y2="950" stroke="#5d4037" stroke-width="3" />

                                <line x1="50" y1="450" x2="50" y2="550" stroke="#5d4037" stroke-width="3" />
                                <line x1="850" y1="450" x2="850" y2="550" stroke="#5d4037" stroke-width="3" />

                                <line x1="350" y1="50" x2="550" y2="250" stroke="#5d4037" stroke-width="2" />
                                <line x1="550" y1="50" x2="350" y2="250" stroke="#5d4037" stroke-width="2" />
                                <line x1="350" y1="750" x2="550" y2="950" stroke="#5d4037" stroke-width="2" />
                                <line x1="550" y1="750" x2="350" y2="950" stroke="#5d4037" stroke-width="2" />

                                <text x="250" y="520" fill="#5d4037" font-size="50" font-family="SimKai, serif" text-anchor="middle">楚 河</text>
                                <text x="650" y="520" fill="#5d4037" font-size="50" font-family="SimKai, serif" text-anchor="middle" transform="rotate(180 650 520)">漢 界</text>

                                <g id="flowers" stroke="#5d4037" stroke-width="2" fill="none"></g>
                            </svg>

                            <div id="piece-layer"></div>
                            <div id="notification" class="notification">Check!</div>
                        </div>
                    </div>

                    <!-- Start/Setup Modal -->
                    <div id="setup-modal" class="modal-overlay" style="display: flex;">
                        <div class="modal">
                            <h2>Xiangqi</h2>
                            <p>Choose your side to begin:</p>
                            <div class="modal-btn-group">
                                <a id="back" class="btn" href="/"><i class="fas fa-step-backward"></i></a>
                                <button class="btn" onclick="game.startGame('red')">Play RED (Move First)</button>
                                <button class="btn" onclick="game.startGame('black')">Play BLACK (AI Moves First)</button>
                            </div>
                        </div>
                    </div>

                    <!-- Rules Modal -->
                    <div id="rules-modal" class="modal-overlay">
                        <div class="modal rules-modal">
                            <h2>How to Play</h2>
                            <div class="rules-content">
                                <p>The goal is to capture the enemy <strong>General (King)</strong>. Red always moves first.</p>
                                
                                <h3>Pieces</h3>
                                <ul>
                                    <li><strong>General (帅 / 将):</strong> Moves 1 step orthogonally. Cannot leave the Palace (3x3 grid).</li>
                                    <li><strong>Advisor (仕 / 士):</strong> Moves 1 step diagonally. Cannot leave the Palace.</li>
                                    <li><strong>Elephant (相 / 象):</strong> Moves 2 steps diagonally. Cannot cross the River. Eye can be blocked.</li>
                                    <li><strong>Horse (马):</strong> Moves 1 step orthogonally + 1 step diagonally. Can be blocked.</li>
                                    <li><strong>Chariot (车):</strong> Moves any distance orthogonally.</li>
                                    <li><strong>Cannon (炮 / 砲):</strong> Moves like a Chariot, but must jump over exactly one piece to capture.</li>
                                    <li><strong>Soldier (兵 / 卒):</strong> Moves 1 step forward. After crossing the river, can also move sideways.</li>
                                </ul>

                                <h3>Special Rules</h3>
                                <ul>
                                    <li><strong>Flying General:</strong> The two Generals cannot face each other on the same open file without a piece in between.</li>
                                    <li><strong>River:</strong> Elephants cannot cross. Soldiers gain side movement after crossing.</li>
                                </ul>
                            </div>
                            <button class="btn" onclick="game.hideRules()">Close</button>
                        </div>
                    </div>

                    <!-- Game Over Modal -->
                    <div id="game-over-modal" class="modal-overlay">
                        <div class="modal">
                            <h2 id="modal-title">Game Over</h2>
                            <p id="modal-message">Red Wins!</p>
                            <button class="btn" onclick="game.showSetup()">Main Menu</button>
                        </div>
                    </div>
                    
                    <script type="text/javascript" src="/website_pinetwork_games_odoo/static/src/js/games/xiangqi_functions.js?v=1.101"></script>

                </body>

            </html>
            </t>
		</template>

</odoo>
